# Generated by Fabric8 CRDGenerator, manual edits might get overwritten!
apiVersion: cicd.innkeeper.run/v1
kind: Guest
metadata:
  name: innkeeper
  namespace: innkeeper
spec:
  builds:
    - name: backend
      namespace: git-builder
      git:
        uri: git@github.com:InnKeeperDevOps/InnKeeperSite.git
        secret: github-ssh
      publish:
        secret: git-repo
        registry: ghcr.io
        tag: innkeeperdevops/innkeeper-site
    - name: example
      namespace: git-builder
      git:
        uri: git@github.com:InnKeeperDevOps/example-nginx.git
        secret: github-ssh
      publish:
        secret: git-repo
        registry: ghcr.io
        tag: innkeeperdevops/example-nginx
  deployments:
    - name: innkeeper-site
      namespace: innkeeper
      replicas: 1
      containers:
        - buildName: backend
          name: backend
    - name: example-site
      namespace: innkeeper
      replicas: 3
      containers:
        - buildName: example
          name: example
  services:
    - name: innkeeper-www
      namespace: innkeeper
      deployment: innkeeper-site
      ports:
        - port: 3000
          name: innkeeper-www
          protocol: "TCP"
          targetPort: 3000
    - name: example-site
      namespace: innkeeper
      deployment: example-site
      ports:
        - port: 80
          name: example-site
          protocol: "TCP"
          targetPort: 80
  ext:
    - type: HTTP_ISTIO
      name: innkeeper-main
      data:
        gateway: internet
        hostnames: "innkeeper.run,www.innkeeper.run"
        service: innkeeper-www
        namespace: innkeeper
        port: 3000
        path: /
    - type: HTTP_ISTIO
      name: innkeeper-example
      data:
        gateway: internet
        hostnames: "example.innkeeper.run"
        service: example-site
        namespace: innkeeper
        port: 80
        path: /
